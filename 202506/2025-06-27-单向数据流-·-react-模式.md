# 单向数据流 · React 模式
- URL: https://sangka.github.io/react-in-patterns-cn/chapter-7/
- Added At: 2025-06-27 05:57:20
- [Link To Text](2025-06-27-单向数据流-·-react-模式_raw.md)

## TL;DR
单向数据流在React中通过集中管理状态于外部store，组件仅订阅数据变化并触发更新，避免双向通讯的复杂性。这实现单一数据源，简化组件为无状态，提升开发效率。

## Summary
单向数据流是一种适合与React搭配的数据管理模式，核心思想是组件不直接修改接收到的数据，而只监听数据变化并基于新值重新渲染。以下是文章核心内容的总结：

1. **基本概念**  
   - 组件通过监听数据变化并使用新值更新UI，而不是直接修改数据源。  
   - 初始示例中，`Switcher`组件使用内部状态管理开关状态（`flag`），通过`setState`控制按钮标签（“lights on”或“lights off”）。

2. **状态管理问题**  
   - 当状态移至外部store时（如全局对象`Store`），UI组件和store各有状态，需双向通讯：组件通过`onChange`回调更新store，store通过props传递初始值给组件。  
   - 导致状态分散管理：如果store的值被其他操作修改，必须同步更新组件，增加复杂度。
   - 工作流程图显示双向流（组件→store和store→组件）的耦合性。

3. **解决方案：单向数据流实现**  
   - 改造store使其可订阅数据变化：添加`subscribe`方法存储处理器，`set`方法更新值时触发所有处理器。  
   - `App`组件订阅store：初始值从store获取，变化时通过回调更新组件状态。  
   - `Switcher`组件简化为无状态函数，只接收`value`和`onChange`作为props，内部不再管理状态。  
   - 工作流程图转为单向流：数据仅从store流向组件→UI交互触发store更新。

4. **主要益处**  
   - 单一数据源：状态集中管理于store，避免多处维护状态的一致性问题。  
   - 简化组件：UI组件只负责展示，逻辑解耦降低复杂度。  
   - 提升开发效率：便于处理数据同步、服务端集成（如恢复初始值）。
