# Client-Side Rendering in Flame Graphs
- URL: https://www.developerway.com/posts/client-side-rendering-flame-graph
- Added At: 2025-08-04 08:02:17
- [Link To Text](2025-08-04-client-side-rendering-in-flame-graphs_raw.md)

## TL;DR
本文介绍了火焰图在优化React客户端渲染（CSR）性能中的应用，分四个模块：火焰图原理解释耗时分析、CSR工作机制与瓶颈说明、使用Chrome工具实战技巧，以及CSR如低运维成本等优势与首屏延迟等缺陷。帮助开发者识别性能瓶颈并决策优化。

## Summary
该文章详细介绍了火焰图在分析React客户端渲染（CSR）性能中的应用，分为四个核心模块：

---

### **一、火焰图基础解析**
1. **火焰图构成原理**  
   - 通过**程序员通勤**的类比（散步、逗狗、买咖啡）解释调用栈层级关系  
   - 关键概念：  
     - **总时间（Total Time）**：函数自身+所有子函数耗时  
     - **自身时间（Self Time）**：仅函数自身逻辑耗时（排除子函数）  
   - 图形特征：子任务呈堆叠状，宽度表示耗时

2. **优化决策方法**  
   - 示例：缩短通勤时间的3种策略  
     - 直接删除任务（如跳过咖啡）  
     - 削减子任务（APP提前下单）  
     - 减少自身时间（骑自行车）  
   - 强调需权衡**优化成本**（如开发效率vs体验影响）

---

### **二、客户端渲染核心机制**
1. **CSR工作原理**  
   - HTML仅包含空`<div id="root">`和JS/CSS引用  
   - React通过`createRoot`将组件树注入DOM：  
   ```js
   createRoot(document.getElementById('root')).render(<App />)
   ```
   - **关键影响**：内容生成完全依赖JS执行

2. **性能瓶颈特征**  
   - 火焰图呈现典型模式：  
     - 解析HTML（蓝色短条）→ 长JS执行（黄色条块）→ 布局渲染（紫色块）→ FCP/LCP触发  
   - 与SSR对比（如MDN文档）：  
     | 渲染模式 | 关键差异                          | 性能表现         |
     |----------|---------------------------------|-----------------|
     | CSR      | JS执行后才触发LCP               | 初始加载延迟明显 |
     | SSR      | 首屏快速渲染→JS异步执行          | LCP触发更早     |

---

### **三、实战火焰图分析技巧**
1. **Chrome性能面板操作指南**  
   - 消除干扰：**隐身模式**屏蔽插件噪音  
   - 关键操作：  
     - 点击色块查看**总时间/自身时间**  
     - "Summary"面板溯源代码位置  
     - 右键隐藏无关子任务（如Parse HTML子项）  

2. **布局渲染观察重点**  
   - 紫色"Layout"块体积反映渲染成本  
   - 真实应用案例：布局耗时占比达JS总时长1/3  

---

### **四、CSR价值与局限**
1. **优势场景**  
   - **超低运维成本**：纯静态文件部署（接近零服务器开销）  
   - **交互密集型应用**：SPA快速响应后续交互（如项目管理工具）  
   - 接受初始化延迟换取运行时性能的场景  

2. **核心缺陷**  
   - **JS阻塞首屏**：禁用JS时页面完全空白  
   - **LCP延迟**：需等待JS包解析+执行完成  
   - 建议优化方向：代码分割/预加载/流式渲染  

> 文章通过开源[Study Project](https://github.com/developerway/reading-flame-graph)提供实操环境，强调火焰图对量化优化效果的关键作用。
